!function(){function t(){BOOMTRAIN_API_KEY="",PARTNER_API_KEY=""}VERSION="1.0.1",DEBUG_MODE=!1,PARTNER_LIBRARY_LOCATION="https://d3r7h55ola878c.cloudfront.net/btn/"+VERSION+"/nudgespot-loader.js",BT_LOAD_STARTED=!1,PARTNER_LOAD_STARTED=!1,PARTNER_NAME="Nudgespot";var e=[],n={emailAddress:"",dataFields:[],isSet:function(){return!(null==this.emailAddress||0===this.emailAddress.length)}},i=window.console,o={log:function(){if(DEBUG_MODE&&i)try{i.log.apply(i,arguments)}catch(t){_btn.each(arguments,function(t){i.log(t)})}},err:function(){if(DEBUG_MODE&&i)try{i.log.apply(i,arguments)}catch(t){_btn.each(arguments,function(t){i.log(t)})}}},r=Array.prototype,a=Object.prototype,u=r.slice,s=(a.toString,a.hasOwnProperty),d=r.forEach,c=(Array.isArray,Object.keys);t.prototype={setDebugMode:function(t){DEBUG_MODE=t,_btn.log("Boomtrain ProjectN Version "+VERSION)},include:function(t,e){var n=document.getElementsByTagName("head")[0],i=document.createElement("script");i.src=t,i.type="text/javascript",i.onload=i.onreadystatechange=function(){i.readyState?("complete"===i.readyState||"loaded"===i.readyState)&&(i.onreadystatechange=null,e()):e()},n.appendChild(i)},setAPIKeys:function(t,e){BOOMTRAIN_API_KEY=t,PARTNER_API_KEY=e},runQueuedCalls:function(){for(;e.length>0;)e.shift()(),_btn.log("Running queued function")},queueFunction:function(t,n,i,o){fnToQueue=function(){t.apply(n,i)},e.push(fnToQueue),_btn.log("Queued function");var r=function(){};(o=o||r)()},initialize:function(t,e,i){e&&""!=e||(e={}),BT_LOAD_STARTED?(_btn.log("Boomtrain already loaded."),t?(n.emailAddress=t,_btn.log("User data passed as argument to Initialize().")):(_btn.log("Fetching user from cookie."),n.emailAddress=_btn.getCookie("bt-email"),n.emailAddress||_btn.log("No user found. Logging in anonymously.")),e&&(n.dataFields=e),n.isSet()&&(_btn.log("Setting up current user."),_btn.setupCurrentUser(n,function(){var t=function(){};(i=i||t)()}))):(BT_LOAD_STARTED=!0,_btn.include("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js",function(){_btn.log("UnderscoreJS loaded."),t?(n.emailAddress=t,_btn.log("User data passed as argument to Initialize().")):(_btn.log("Fetching user from cookie."),n.emailAddress=_btn.getCookie("bt-email"),n.emailAddress||_btn.log("No user found. Logging in anonymously.")),n.dataFields=e,_btn.include("https://cdn.boomtrain.com/analyticstrain/"+BOOMTRAIN_API_KEY+"/analyticstrain.min.js",function(){if(_btn.log("Boomtrain analytics loaded."),n.isSet())_btn.setupCurrentUser(n,function(){var t=function(){};(i=i||t)()});else{_btn.runQueuedCalls();var t=function(){};i=i||t,i()}})}))},setupCurrentUser:function(t,e){if(window._bt)_btn.setCookie("bt-email",t.emailAddress,365),btUserDataFields={source:this.getValue(t,"source"),membershipType:this.getValue(t,"membershipType")},_bt.person.set(_btn.extend({email:t.emailAddress},btUserDataFields),function(){if(_btn.log("Boomtrain user identified: "+t.emailAddress),PARTNER_LOAD_STARTED){_btn.log(PARTNER_NAME+" already loaded."),_btn.runQueuedCalls();var n=function(){};e=e||n,e()}else PARTNER_LOAD_STARTED=!0,_btn.include(PARTNER_LIBRARY_LOCATION,function(){_btn.log(PARTNER_NAME+" analytics loaded."),nudgespot.init(PARTNER_API_KEY),nudgespot.identify(t.emailAddress,t.dataFields),o.log("Datafields"+JSON.stringify(t.dataFields)),btResourceDataFields={app:_bt.app,bsin:_bt.identity.props.bsin,app_member_id:_bt.identity.props.app_member_id,userId:_bt.identity.props.bsin||_bt.identity.props.app_member_id,session:_bt.session.id,url:window.location.href},nudgespot.track("Viewed",btResourceDataFields,function(){_btn.log(PARTNER_NAME+" viewed event triggered."),_btn.runQueuedCalls();var t=function(){};(e=e||t)()})})});else{this.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded! Queuing user setup."),_btn.queueFunction(_btn.setupCurrentUser,this,arguments);var n=function(){};e=e||n,e()}},getValue:function(t,e){return t.length&&t.hasOwnProperty(e)?t[e]:null},log:function(t){o.log(t)},err:function(t,e){o.log("Error: "+t+". "+e)},track:function(t,e,n){if(""==e&&(e={}),window._bt)_bt.track(t,e,function(){_btn.log("Boomtrain track event: "+t),window.nudgespot&&nudgespot.track(t,e,function(){_btn.log(PARTNER_NAME+" track event: "+t);var e=function(){};(n=n||e)()})});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added Track command to queue."),_btn.queueFunction(_btn.track,this,arguments);var i=function(){};n=n||i,n()}},trackPurchase:function(t,e,i,o){if(""==e&&(e={}),""==i&&(i={}),PurchaseDetails={orderTotal:t,shoppingCartItems:e,dataFields:i},window._bt)_bt.track("trackPurchase",PurchaseDetails,function(){if(_btn.log("Boomtrain track event: trackPurchase"),window.nudgespot)nudgespot.track("purchase",PurchaseDetails,function(){nudgespot.identify(n.emailAddress,{shoppingCartItems:[]},function(){_btn.log(PARTNER_NAME+" track event: purchase");var t=function(){};(o=o||t)()})});else{var t=function(){};o=o||t,o()}});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added TrackPurchase command to queue."),_btn.queueFunction(_btn.trackPurchase,this,arguments);var r=function(){};o=o||r,o()}},trackUpdateCart:function(t,e){if(""==t&&(t={}),window._bt)_bt.track("updateCart",{items:t},function(){if(_btn.log("Boomtrain track event: updateCart"),window.nudgespot)nudgespot.track("update_cart",{items:t},function(){nudgespot.identify(n.emailAddress,{shoppingCartItems:t},function(){_btn.log(PARTNER_NAME+" track event: update_cart");var t=function(){};(e=e||t)()})});else{var i=function(){};e=e||i,e()}});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added UpdateCart command to queue."),_btn.queueFunction(_btn.trackUpdateCart,this,arguments);var i=function(){};e=e||i,e()}},identify:function(t,e){if(t)if(window._bt)_bt.identify(t,function(){_btn.log("Boomtrain identify: "+t),window.nudgespot&&nudgespot.identify(n.emailAddress,{uniqueId:t},function(){_btn.log("Nudgespot identify: "+t);var n=function(){};(e=e||n)()})});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added Identify command to queue."),_btn.queueFunction(_btn.identify,this,arguments);var i=function(){};e=e||i,e()}else{this.err("identify","No uniqueId provided!");var i=function(){};e=e||i,e()}},trackAccountSignup:function(t,e,i){if(window._bt)""==t?this.err("trackAccountSignup","Email address needed."):(n.emailAddress=t,n.dataFields=e,_btn.setCookie("bt-email",n.emailAddress,365),n.isSet()?_btn.setupCurrentUser(n,function(){_btn.track("startedMembership",n.dataFields,function(){var t=function(){};(i=i||t)()})}):this.err("trackAccountSignup","Could not set email address, are you sure it is valid?"));else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added TrackAccountSignup command to queue."),_btn.queueFunction(_btn.trackAccountSignup,this,arguments);var o=function(){};i=i||o,i()}},trackAccountCompleted:function(t,e,i){if(window._bt)""==t?this.err("trackAccountCompleted","Email address needed."):(n.emailAddress=t,n.dataFields=e,n.isSet()?_btn.track("completedMembership",n.dataFields,function(){var t=function(){};(i=i||t)()}):this.err("trackAccountCompleted","Could not set email address, are you sure it is valid?"));else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added TrackAccountCompleted command to queue."),_btn.queueFunction(_btn.trackAccountCompleted,this,arguments);var o=function(){};i=i||o,i()}},trackAddCart:function(){},trackRemoveCart:function(){},trackShipped:function(){},trackReviewStarted:function(){},trackReviewCompleted:function(){},trackView:function(t){},extend:function(t){return _btn.each(u.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},each:function(t,e,n){if(null==t)return t;if(d&&t.forEach===d)t.forEach(e,n);else if(t.length===+t.length){for(var i=0,o=t.length;o>i;i++)if(e.call(n,t[i],i,t)===breaker)return}else for(var r=_btn.keys(t),i=0,o=r.length;o>i;i++)if(e.call(n,t[r[i]],r[i],t)===breaker)return;return t},keys:function(t){if(!_btn.isObject(t))return[];if(c)return c(t);var e=[];for(var n in t)_btn.has(t,n)&&e.push(n);return e},has:function(t,e){return s.call(t,e)},isObject:function(t){return t===Object(t)},setCookie:function(t,e,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var o="expires="+i.toUTCString();document.cookie=t+"="+e+"; "+o},getCookie:function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""},checkCookie:function(){var t=getCookie("username");""!=t?alert("Welcome again "+t):(t=prompt("Please enter your name:",""),""!=t&&null!=t&&setCookie("username",t,365))}},window._btn=new t}();